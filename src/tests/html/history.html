<!DOCTYPE html>
<script src="../testing.js"></script>

<script id=history>
    testing.expectEqual('auto', history.scrollRestoration);

    history.scrollRestoration = 'manual';
    history.scrollRestoration = 'foo';
    testing.expectEqual('manual', history.scrollRestoration);

    history.scrollRestoration = 'auto';
    testing.expectEqual('auto', history.scrollRestoration);
    testing.expectEqual(null, history.state)

    history.pushState({ testInProgress: true }, null, 'http://127.0.0.1:9582/xhr/json');
    testing.expectEqual({ testInProgress: true }, history.state);

    history.replaceState({ "new": "field", testComplete: true }, null);
    let state = { "new": "field", testComplete: true };
    testing.expectEqual(state, history.state);

    let popstateEventFired = false;
    let popstateEventState = null;

    window.addEventListener('popstate', (event) => {
        popstateEventFired = true;
        popstateEventState = event.state;
    });

    testing.eventually(() => {
      testing.expectEqual(true, popstateEventFired);
      testing.expectEqual(state, popstateEventState);
    })

    testing.onPageWait(() => {
      testing.expectEqual(true, history.state && history.state.testComplete);
      testing.expectEqual(state, history.state);
    });

    testing.expectEqual(undefined, history.go());
</script>

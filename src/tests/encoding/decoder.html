<!DOCTYPE html>
<meta charset="UTF-8">

<script src="../testing.js"></script>
<script id=decoder>
  let d1 = new TextDecoder();
  testing.expectEqual('utf-8', d1.encoding);
  testing.expectEqual(false, d1.fatal);
  testing.expectEqual(false, d1.ignoreBOM);

  testing.expectEqual('', d1.decode());
  testing.expectEqual('𠮷', d1.decode(new Uint8Array([240, 160, 174, 183])));
  testing.expectEqual('𠮷', d1.decode(new Uint8Array([0xEF, 0xBB, 0xBF, 240, 160, 174, 183])));
  testing.expectEqual('�2', d1.decode(new Uint8Array([249, 50])));

  {
    const buffer = new ArrayBuffer(4);
    const ints = new Uint8Array(buffer)
    ints[0] = 240;
    ints[1] = 160;
    ints[2] = 174;
    ints[3] = 183;
    testing.expectEqual('𠮷', d1.decode(buffer));
  }

  {
    const buffer = new ArrayBuffer(4);
    const dv = new DataView(buffer);
    dv.setUint8(0, 240);
    dv.setUint8(1, 160);
    dv.setUint8(2, 174);
    dv.setUint8(3, 183);
    testing.expectEqual('𠮷', d1.decode(dv));
  }

  let d2 = new TextDecoder('utf8', {fatal: true})
  testing.expectError('Error: InvalidUtf8', () => {
    let data  = new Uint8Array([240, 240, 160, 174, 183]);
    d2.decode(data);
  });
</script>

<script id=stream>
  let d3 = new TextDecoder();
  testing.expectEqual('', d2.decode(new Uint8Array([226, 153]), { stream: true }));
  testing.expectEqual('♥', d2.decode(new Uint8Array([165]), { stream: true }));
</script>

<script id=slice>
    const buf1 = new ArrayBuffer(7);
    const arr1 = new Uint8Array(buf1)
    arr1[0] = 80;
    arr1[1] = 81;
    arr1[2] = 82;
    arr1[3] = 83;
    arr1[4] = 84;
    arr1[5] = 85;
    arr1[6] = 86;
    testing.expectEqual('RST', d3.decode(new Uint8Array(buf1, 2, 3)));
</script>
